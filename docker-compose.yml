

# services:
#   # ======= Base de Datos =======
#   postgres:
#     image: postgres:16-alpine
#     container_name: lhamsdj_db
#     restart: always
#     environment:
#       POSTGRES_USER: lhamsdj_user
#       POSTGRES_PASSWORD: lhamsdj_secret_123
#       POSTGRES_DB: lhamsdj_db
#     ports:
#       - "5432:5432"
#     volumes:
#       - postgres_data:/var/lib/postgresql/data
#     healthcheck:
#       test: ["CMD-SHELL", "pg_isready -U lhamsdj_user -d lhamsdj_db"]
#       interval: 5s
#       timeout: 5s
#       retries: 5

#   # ======= Backend (Express + Prisma) =======
#   backend:
#     build:
#       context: ./backend
#       dockerfile: Dockerfile
#     container_name: lhamsdj_backend
#     restart: always
#     ports:
#       - "3001:3001"
#     environment:
#       NODE_ENV: production
#       PORT: 3001
#       DATABASE_URL: postgresql://lhamsdj_user:lhamsdj_secret_123@postgres:5432/lhamsdj_db
#       # Agrega aquí tus otras variables de entorno:
#       # JWT_SECRET: tu_jwt_secret
#       # STRIPE_SECRET_KEY: tu_stripe_key
#     depends_on:
#       postgres:
#         condition: service_healthy

#   # ======= Frontend (Next.js) =======
#   frontend:
#     build:
#       context: ./frontend
#       dockerfile: Dockerfile
#     container_name: lhamsdj_frontend
#     restart: always
#     ports:
#       - "3000:3000"
#     environment:
#       NEXT_PUBLIC_API_URL: http://backend:3001
#     depends_on:
#       - backend

# volumes:
#   postgres_data:




services:
  postgres:
    image: postgres:16-alpine
    container_name: lhamsdj_db
    restart: always
    environment:
      POSTGRES_USER: lhamsdj_user
      POSTGRES_PASSWORD: lhamsdj_secret_123
      POSTGRES_DB: lhamsdj_db
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U lhamsdj_user -d lhamsdj_db"]
      interval: 5s
      timeout: 5s
      retries: 5

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: lhamsdj_backend
    restart: always
    ports:
      - "3001:3001"
    environment:
      NODE_ENV: production
      PORT: 3001
      DATABASE_URL: postgresql://lhamsdj_user:lhamsdj_secret_123@postgres:5432/lhamsdj_db
    depends_on:
      postgres:
        condition: service_healthy

  # frontend:
  #   (lo agregas después cuando tengas el código)

volumes:
  postgres_data: